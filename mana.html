<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link href="/BaseStation/assets/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
    <link href="/BaseStation/assets/ligerUI/skins/Gray/css/all.css" rel="stylesheet" type="text/css" />
    <script src="/BaseStation/assets/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/core/base.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerForm.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerResizable.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerTree.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerButton.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerRadio.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerTip.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/ligerUI/js/plugins/ligerToolBar.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/jquery-validation/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/jquery-validation/jquery.metadata.js" type="text/javascript"></script>
    <script src="/BaseStation/assets/jquery-validation/messages_cn.js" type="text/javascript"></script>
    <script src="/BaseStation/scripts/baseStations.js"></script>
    <script type="text/javascript">
        var addw, editw;
        function itemclick(item) {
            if (item.id == "add") {
                addw = f_open2("add.html", "新增基站");
            }
            else if (item.id == "del") {
                $.ligerDialog.warn("尚未实现");
                //commondel();
            }
        }
        function f_open2(url, title) {
            return $.ligerDialog.open({
                title: title, url: url, height: 357, width: 440, isResize: true
            });
        }
        function editRow(id) {
            editw = f_open2("edit.html?id=" + id, "编辑基站");
        }
        function deleteRow(id) {
            $.ligerDialog.warn("尚未实现");
            return;

            $.ligerDialog.confirm("确认删除此条记录吗?", function (isTrue) {
                if (!isTrue)
                    return;
                //ajax删除
                $.ajax({
                    url: "../Handler/ReqHandler.ashx?method=delete&para=project@ids$" + id,
                    type: "post",
                    success: function (result) {
                        var res = jQuery.parseJSON(result);
                        if (res.Code == "ok") {
                            top.f_success("记录删除成功");
                            window.location.reload();
                        }
                        else {
                            top.f_warn("记录删除失败");
                        }
                    },
                    error: function () {
                        top.f_error("访问错误");
                    }
                });

            });
        }
        function commondel() {
            var node = grid.getCheckedRows();
            if (node) {
                var stext = "";
                var sid = "";
                for (var i = 0; i < node.length; i++) {
                    stext += node[i]['name'] + ",";
                    sid += node[i]['id'] + ",";
                }
                if (stext != "" && sid != "") {
                    stext = stext.substr(0, stext.length - 1);
                    sid = sid.substr(0, sid.length - 1);
                    $.ligerDialog.confirm("确定删除记录:" + stext, function (isTrue) {
                        if (!isTrue)
                            return;
                        //ajax删除
                        $.ajax({
                            url: "../Handler/ReqHandler.ashx?method=delete&para=project@ids$" + sid,
                            type: "post",
                            dataType: 'json',
                            success: function (res) {
                                if (res.Code == "ok") {
                                    top.f_success("记录删除成功");
                                    window.location.reload();
                                }
                                else {
                                    top.f_warn("记录删除失败");
                                }
                            },
                            error: function () {
                                top.f_error("访问错误");
                            }
                        });
                    });
                }
            }
            else
                top.f_warn('请先选择记录');
        }
        var grid = null;
        var origdata = null;
        $(function () {
            grid = $("#maingrid4").ligerGrid({
                checkbox: true,
                columns: [
                { display: '基站名称', name: 'name', width:80},
                { display: '上次更新时间', name: 'update_time', isSort: true,width:80 },
                { display: 'LAC', name: 'lac' },
                { display: 'CI', name: 'ci' },
                { display: '方位角', name: 'direction_angle' },
                { display: '下倾角', name: 'inclination_angle' },
                { display: '地址', name: 'address' },
                { display: '经度', name: 'lng' },
                { display: '纬度', name: 'lat' },
                {
                    display: '操作', isSort: false, width: 120, render: function (rowdata, rowindex, value) {
                        var h = "";

                        h += "<a class='l-link' href='javascript:editRow(" + rowdata.id + ")'><img class='l-image' src='/BaseStation/assets/ligerUI/skins/Gray/images/metro/edit.png'/>编辑</a> ";
                        h += "<a class='l-link' href='javascript:deleteRow(" + rowdata.id + ")'><img class='l-image' src='/BaseStation/assets/ligerUI/skins/Gray/images/metro/del.png'/>删除</a> ";

                        return h;
                    }
                }
                ], pageSize: 30,
                data: $.extend(true, {}, base_station_grid_data),
                height: '100%',
                toolbar: {
                    items: [
                { id: 'add', text: '增加', click: itemclick, img: '/BaseStation/assets/ligerUI/skins/Gray/images/metro/add.png' },
                { line: true },
                { id: 'del', text: '删除所选', click: itemclick, img: '/BaseStation/assets/ligerUI/skins/Gray/images/metro/del.png' }
                    ]
                }
            });
            origdata = grid.data;

            $("#pageloading").hide();
        });
        function f_search() {
            grid.options.data = $.extend(true, {}, base_station_grid_data);
            grid.loadData(f_getWhere());
        }
        function f_getWhere() {
            if (!grid) return null;
            var clause = function (rowdata, rowindex) {
                var key = $("#Name").val();
                return rowdata.name.indexOf(key) > -1;
            };
            return clause;
        }
    </script>
    <style type="text/css">
        table#searchbar {
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <div id="message" style="width: 90%"></div>
    <div class="l-loading" style="display: block" id="pageloading"></div>
    <br />
    <table border="0" id="searchbar">
        <tr>
            <td>
                <input id="Name" type="text" placeholder="检索基站名称" />
            </td>
            <td>
                <input id="btnOK" class="l-button" type="button" value="查询" onclick="f_search()" />
            </td>
        </tr>
    </table>
    <br />
    <div id="maingrid4" style="margin: 0; padding: 0;"></div>
</body>
</html>
